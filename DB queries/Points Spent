-- Create POINTS_SPENT Table --
CREATE TABLE POINTS_SPENT (
    points_spent_id NUMBER(10) CONSTRAINT points_spent_id_pk PRIMARY KEY,
    batch_id NUMBER(10) CONSTRAINT points_spent_batch_id_nn NOT NULL,
    transaction_id NUMBER(10) CONSTRAINT points_spent_trans_id_nn NOT NULL,
    points_used NUMBER(10) CONSTRAINT points_used_nn NOT NULL
        CONSTRAINT points_used_ck CHECK (points_used < 0),
    used_at TIMESTAMP CONSTRAINT points_used_at_nn NOT NULL,
    CONSTRAINT points_spent_batch_fk FOREIGN KEY (batch_id) REFERENCES POINTS_BATCHES(batch_id),
    CONSTRAINT points_spent_trans_fk FOREIGN KEY (transaction_id) REFERENCES TRANSACTIONS(transaction_id)
);

-- Insert POINTS_SPENT records for redemption transactions --
INSERT INTO POINTS_SPENT (points_spent_id, batch_id, transaction_id, points_used, used_at) VALUES
(points_spent_seq.NEXTVAL, 788, 304, -99, TIMESTAMP '2025-07-20 18:15:30');
INSERT INTO POINTS_SPENT (points_spent_id, batch_id, transaction_id, points_used, used_at) VALUES
(points_spent_seq.NEXTVAL, 794, 306, -9, TIMESTAMP '2025-09-05 19:45:00');
INSERT INTO POINTS_SPENT (points_spent_id, batch_id, transaction_id, points_used, used_at) VALUES
(points_spent_seq.NEXTVAL, 795, 307, -399, TIMESTAMP '2025-10-12 11:30:00');
INSERT INTO POINTS_SPENT (points_spent_id, batch_id, transaction_id, points_used, used_at) VALUES
(points_spent_seq.NEXTVAL, 796, 310, -50, TIMESTAMP '2025-01-05 17:35:00');
INSERT INTO POINTS_SPENT (points_spent_id, batch_id, transaction_id, points_used, used_at) VALUES
(points_spent_seq.NEXTVAL, 797, 311, -40, TIMESTAMP '2025-02-10 19:50:00');